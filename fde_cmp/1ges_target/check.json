{
    "code": {
        "BFmate": [
            "COMMON double *inelmc8;",
            "$CC double pe,pv,fx,fy,fz,rou,alpha,t0,time1,a,b,prag,dln,shearqrev,factqrev;",
            "$CC double vi,qnn,shearwave;",
            "$CC int kq,ntime,ialpha;",
            "$CC extern double getyield(double *,double *,double *,double,double *,",
            "$CC int,double (*f)(),int);",
            "$CC extern double prager(double *,double *);",
            "ARRAY dev[3],dep[3],^e[3][3],^d[3][3],^qrev[3][3],^dwave[3][3],^dsv1[3][3]",
            "$CC double ddf[8],ddg[8],ds[8],str[8],p[5];",
            "$CC static int init=0;",
            "$CC int m;",
            "$I",
            "$CC m = ngaus*7;",
            "$CC if (init==0) {",
            "$CC inelmc8 = (double *) calloc(nelem*m+1,sizeof(double));",
            "$CC for (i=1; i<=nelem*m; ++i) inelmc8[i]=0.0;",
            "$CC init = 1; }",
            "@L singular.xyz n"
        ],
        "AFmate": [
            "$CC t0 = 0.0;",
            "$CC ntime=(tmax-t0)/dt;",
            "$CC time1=time_now/ntime;",
            "$CC kq=qnn+0.5;",
            "$CC p[3]=pv;"
        ],
        "func": [
            "$CC fact=pe/(1.0+pv)/(1.0-2.0*pv);",
            "$CC shear=(0.5-pv)*fact;",
            "$CV ^d_i_j=+sm_i_j*fact",
            "$CC factqrev=1/vi;",
            "$CC shearqrev=factqrev;",
            "$CV ^qrev_i_j=qrevm_i_j*factqrev",
            "$CC det=invm(3,d,e);",
            "$CV ^d_i_j = ^e_i_j",
            "$CV ^dwave_i_j=+^d_i_j+^qrev_i_j*dt",
            "$CC shearwave=1/shear+shearqrev*dt;",
            "$CC det=invm(3,dwave,d);",
            "$CC shearwave=1/shearwave;",
            "$CC shear=shearwave;",
            "@L vol.xyz n",
            "$CC j = (num-1)*ngaus*7+(igaus-1)*7;",
            "$CC for (i=1; i<=7; ++i) str[i]=inelmc8[j+i];",
            "@L gradv.xyz m ^e x y z un vn wn",
            "$CV dev_i=^e_i_i",
            "$CC dep[1] = ^e[2][3]+^e[3][2];",
            "$CC dep[2] = ^e[1][3]+^e[3][1];",
            "$CC dep[3] = ^e[1][2]+^e[2][1];",
            "$CV dsv_i=+^d_i_j*dev_j",
            "$CV dsp_i=shear*dep_i",
            "$CC ialpha=1;",
            "$CC a=getyield(p,str,d,shear,ddf,kq,prager,ialpha);",
            "$CC prag=prager(p,str);",
            "$CC dln=ddf[1]*dev[1]+ddf[2]*dev[2]+ddf[3]*dev[3]",
            "$CC +ddf[4]*dep[1]+ddf[5]*dep[2]+ddf[6]*dep[3]+prag;",
            "$CV str_i=str_i+ds_i",
            "$CC if (dln>0.0) {",
            "$CC  b=1.0/a;",
            "$CV dsv_i=+b*ddgv_i*ddfv_j*dev_j",
            "$CV dsp_i=+b*ddgp_i*ddfp_i*dep_i",
            "$CV strv_i=+strv_i-dsv_i-ddgv_i*prag*b",
            "$CV strp_i=+strp_i-dsp_i-ddgp_i*prag*b",
            "$CC } else {",
            "$CC  b=0.0;",
            "$CC }",
            "$CV ^dsv1_i_k=+^d_i_j*^qrev_j_k",
            "$CV dsv_i=+^dsv1_i_k*strv_k*dt",
            "$CV dsp_i=+shear*shearqrev*strp_i*dt",
            "$CV str_i=+str_i+ds_i",
            "$CC ialpha=1;",
            "$CC a=getyield(p,str,d,shear,ddf,kq,prager,ialpha);",
            "$CC prag=prager(p,str);",
            "@L gradv.xyz f fe",
            "@W ev fe 1 5 9",
            "@S fev fe 1 5 9",
            "@A fe_i_j=+[fe_i_j]+[fe_j_i]",
            "@W ep fe 6 3 2",
            "@S fep fe 6 3 2",
            "@A fp_1=+[fev_i]*ddfv_i+[fep_j]*ddfp_j",
            "@A gp_1=+[fev_i]*ddgv_i+[fep_j]*ddgp_j",
            "@W plast fp",
            "@W plastg gp"
        ]
    },
    "disp": [
        "u",
        "v",
        "w"
    ],
    "coor": [
        "x",
        "y",
        "z"
    ],
    "coef": [
        "un",
        "vn",
        "wn"
    ],
    "func": [
        "exx",
        "eyy",
        "ezz",
        "eyz",
        "exz",
        "exy",
        "plast",
        "plastg"
    ],
    "vect": {
        "evp": [
            "exx",
            "eyy",
            "ezz",
            "eyz",
            "exz",
            "exy"
        ],
        "ev": [
            "exx",
            "eyy",
            "ezz"
        ],
        "ep": [
            "eyz",
            "exz",
            "exy"
        ],
        "plast": [
            "plast"
        ],
        "plastg": [
            "plastg"
        ],
        "ddfv": [
            "ddf[1]",
            "ddf[2]",
            "ddf[3]"
        ],
        "ddfp": [
            "ddf[4]",
            "ddf[5]",
            "ddf[6]"
        ],
        "ddgv": [
            "ddg[1]",
            "ddg[2]",
            "ddg[3]"
        ],
        "ddgp": [
            "ddg[4]",
            "ddg[5]",
            "ddg[6]"
        ],
        "str": [
            "str[1]",
            "str[2]",
            "str[3]",
            "str[4]",
            "str[5]",
            "str[6]"
        ],
        "strv": [
            "str[1]",
            "str[2]",
            "str[3]"
        ],
        "strp": [
            "str[4]",
            "str[5]",
            "str[6]"
        ],
        "ds": [
            "ds[1]",
            "ds[2]",
            "ds[3]",
            "ds[4]",
            "ds[5]",
            "ds[6]"
        ],
        "dsv": [
            "ds[1]",
            "ds[2]",
            "ds[3]"
        ],
        "dsp": [
            "ds[4]",
            "ds[5]",
            "ds[6]"
        ],
        "u": [
            "u",
            "v",
            "w"
        ],
        "f": [
            "fx",
            "fy",
            "fz"
        ]
    },
    "shap": [
        [
            "%1",
            "%2"
        ]
    ],
    "gaus": [
        "%3"
    ],
    "mate": [
        "pe",
        "pv",
        "vi",
        "fx",
        "fy",
        "fz",
        "p[1]",
        "p[2]",
        "p[4]",
        "qnn",
        "rou",
        "alpha",
        "1.0e010",
        "0.3",
        "1.0e020",
        "0.0",
        "0.0",
        "0.0",
        "0.2",
        "1000.0",
        "0.0",
        "3.0",
        "3000.0",
        "0.6"
    ],
    "matrix": {
        "sm": [
            "3",
            "3",
            "(1.-pv) pv pv",
            "pv (1.-pv) pv",
            "pv pv (1.-pv)"
        ],
        "qrevm": [
            "3",
            "3",
            "1./3.0 -1./6.0 -1./6.0",
            "-1./6.0 1./3.0 -1./6.0",
            "-1./6.0 -1./6.0 1./3.0"
        ]
    },
    "fmatr": {
        "fe": [
            "3",
            "3"
        ]
    },
    "fvect": {
        "fev": [
            "3"
        ],
        "fep": [
            "3"
        ],
        "fp": [
            "1"
        ],
        "gp": [
            "1"
        ]
    },
    "stif": [
        "dist",
        "+[ev_i;ev_j]*^d_i_j*vol+[ep_i;ep_i]*shear*vol-[plast;plastg]*b*vol"
    ],
    "load": [
        "+[u_i]*f_i*time1*vol-[evp_i]*str_i*vol+[plastg]*b*prag*vol",
        "+[ev_i]*^d_i_j*^qrev_j_k*strv_k*dt+[ep_i]*shear*shearqrev*strp_i*dt",
        "-[plastg]*b*ddfv_i*^qrev_i_j*strv_j*dt",
        "-[plastg]*b*ddfp_i*shearqrev*strp_i*dt"
    ]
}